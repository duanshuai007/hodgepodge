海思摄像头开发：
SONY_IMX178_1024x768_30FPS
这是自定义的一个1024x768分辨率的宏，这个宏能够让我们获得1024*768分辨率的图片。


海思通过HI_MPI_VPSS_GetChnFrame获取缩放图
VpssChn 0 不支持缩放，所以需要选择其他通道。看了手册HiMPP IPC V2.0 媒体处理软件开发参考.pdf 5.2.3节表5-1VPSS通道规格选择了具有缩放能力的通道1.
代码:
    VpssChn = 1;
    stVpssChnMode.enChnMode     = VPSS_CHN_MODE_USER;
    stVpssChnMode.bDouble       = HI_FALSE;
    stVpssChnMode.enPixelFormat = SAMPLE_PIXEL_FORMAT;
#if 1
    stVpssChnMode.u32Width      = stSize.u32Width / 3;
    stVpssChnMode.u32Height     = stSize.u32Height / 3;
#else
    stVpssChnMode.u32Width      = stSize.u32Width;
    stVpssChnMode.u32Height     = stSize.u32Height;
#endif
    stVpssChnMode.enCompressMode = COMPRESS_MODE_NONE;

    memset(&stVpssChnAttr, 0, sizeof(stVpssChnAttr));
    stVpssChnAttr.s32SrcFrameRate = -1; 
    stVpssChnAttr.s32DstFrameRate = -1; 
    s32Ret = SAMPLE_COMM_VPSS_EnableChn(VpssGrp, VpssChn, &stVpssChnAttr, &stVpssChnMode, HI_NULL);

如果要将HI_MPI_VPSS_GetChnFrame获取到的frame保存为图片，需要设置venc的分辨率与输出图片分辨率一致。
    stSize.u32Width = stSize.u32Width / 3;
    stSize.u32Height = stSize.u32Height / 3;
    s32Ret = SAMPLE_COMM_VENC_SnapStart(VencChn, &stSize, HI_FALSE);
    if (HI_SUCCESS != s32Ret)
    {
        SAMPLE_PRT("Start snap failed!\n");
        goto END_VENC_MJPEG_JPEG_5;
    }
这样就能通过我们自定义的函数SaveYuvAsJpegToDisk(VencChn, &stVpssFrame, "sample_step_01.jpg");将该frame保存为图片jpg了。


海思输入源截取目标区域图像进行编码。操作于Vpss上。
#if 1
    VPSS_CROP_INFO_S CropInfo;
    CropInfo.bEnable = HI_TRUE;
    CropInfo.enCropCoordinate = VPSS_CROP_ABS_COOR;
    CropInfo.stCropRect.s32X = (SRC_IMAGE_WIDTH - DST_IMAGE_WIDTH) / 2;
    CropInfo.stCropRect.s32Y = (SRC_IMAGE_HEIGHT - DST_IMAGE_HEIGHT) / 2;
    CropInfo.stCropRect.u32Width = DST_IMAGE_WIDTH;
    CropInfo.stCropRect.u32Height = DST_IMAGE_HEIGHT;
    s32Ret = HI_MPI_VPSS_SetChnCrop(VpssGrp, VpssChn, &CropInfo);
    if (HI_SUCCESS != s32Ret)
    {   
        SAMPLE_PRT("HI_MPI_VPSS_SetChnCrop Failed! code:%x\n", s32Ret);
        goto END_VENC_MJPEG_JPEG_4;


s/17ysVz-nRTrmXMC6kuHF0kw

    }   
#endif
VpssChn = 1 默认是0的通道不支持截取操作.
SRC_IMAGE_WIDTH 是原始图像的尺寸1920x1080
DST_IMAGE_WIDTH 是截取区域的尺寸640x360
 
 0.6667f, 1.7159f


海思输入源截取目标区域图像进行编码。操作于Vi上。
在SAMPLE_COMM_VI_StartChn之前的代码都不需要修改。只修改
HI_MPI_VI_SetChnAttr的参数部分,修改stCapRect的x,y为截取图像的起始坐标，width，height为截取图像的宽高。
在这之后的VPSS，VENC的图像尺寸都需要跟这里修改的尺寸一致。

通过yuv格式数据生成Frame时，数据buffersize的大小会对生成图片产生印象，要求是64对齐的buffersize

修改设置thresh里面的最小值喝最大值，试试修改之后的效果


白天参数
 ./mmmm 1 40 60
晚上的参数
 ./mmmm 1 80 100


每行28个字符输出
 hexdump -e '22/1 "%02x"' -e '"\n"'  -v item_20
 hexdump -e '204/1 "%02x"' -e '"\n"' -v two_thresh.yuv
 hexdump -e '176/1 "%02x"' -e '"\n"' -v cropPlateReal.yuv
 hexdump -e '8/1 "%02x"' -e '"\n"' -v dstitem_8x16_2.yuv


FBERq9MD
 ffmpeg -i one_thresh.jpg -filter_complex "[0:v]rotate='8*PI/180:ow=hypot(iw,ih):oh=ow:c=none'" test.jpg -y


